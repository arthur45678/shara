angular.module("am.multiselect",[]).factory("optionParser",["$parse",function(e){var n=/^\s*([\s\S]+?)(?:\s+as\s+([\s\S]+?))?\s+for\s+(?:([\$\w][\$\w\d]*))\s+in\s+([\s\S]+?)$/;return{parse:function(t){var l=t.match(n);if(!l)throw new Error('Expected typeahead specification in form of "_modelValue_ (as _label_)? for _item_ in _collection_" but got "'+t+'".');return{itemName:l[3],source:e(l[4]),viewMapper:e(l[2]||l[1]),modelMapper:e(l[1])}}}}]).directive("amMultiselect",["$parse","$document","$compile","$interpolate","$filter","optionParser",function(e,n,t,l,a,r){return{restrict:"E",require:"ngModel",link:function(n,i,c,u){function s(){y.items.length=0;var e=k.source(n);if(angular.isDefined(e))for(var t=0;t<e.length;t++){var l={};l[k.itemName]=e[t],y.items.push({label:k.viewMapper(l),model:k.modelMapper(l),checked:!1})}}function o(){if(m(u.$modelValue))return y.header=void 0!==c.msHeader?c.msHeader:"Select";if(b)if(c.msSelected)y.header=l(c.msSelected)(y);else if(1==u.$modelValue.length)for(var e=0;e<y.items.length;e++)y.items[e].model===u.$modelValue[0]&&(y.header=y.items[e].label);else y.header=u.$modelValue+" ";else if(angular.isString(u.$modelValue))y.header=u.$modelValue;else{var n={};n[k.itemName]=u.$modelValue,y.header=k.viewMapper(n)||y.items[u.$modelValue].label}document.getElementById("selected_languages_tags").innerHTML="";angular.forEach(u.$modelValue,function(e){var n=document.createElement("span");n.setAttribute("class","language-tag"),n.addEventListener("click",d);var t=document.createTextNode(e+" Ã—");n.appendChild(t),document.getElementById("selected_languages_tags").appendChild(n)})}function d(){var e=this.innerHTML,n=e.split(" "),t=n[0];console.log(e,n,t);for(var l=0;l<y.items.length;l++)y.items[l].label==t&&y.select(y.items[l])}function m(e){if(angular.isNumber(e))return!1;if(e&&e.length&&e.length>0)return!1;for(var n in e)if(e[n])return!1;document.getElementById("selected_languages_tags").innerHTML="";return!0}function f(e){e.checked?y.uncheckAll():(y.uncheckAll(),e.checked=!e.checked),p(!1)}function g(e){e.checked=!e.checked,p(!0)}function p(e){var n=null;e?(n=[],angular.forEach(y.items,function(e){e.checked&&n.push(e.model)})):angular.forEach(y.items,function(e){if(e.checked)return n=e.model,!1}),u.$setViewValue(n)}function h(e){angular.isArray(e)?angular.forEach(y.items,function(n){n.checked=!1,angular.forEach(e,function(e){angular.equals(n.model,e)&&(n.checked=!0)})}):angular.forEach(y.items,function(n){if(angular.equals(n.model,e))return y.uncheckAll(),n.checked=!0,p(!1),!1})}var $=u.$isEmpty;u.$isEmpty=function(e){return $(e)||angular.isArray(e)&&0==e.length};var v=c.options,k=r.parse(v),b=!!c.multiple,x=!1,y=n.$new(),w=c.change||angular.noop;y.items=[],y.header="Select",y.multiple=b,y.disabled=!1,y.onBlur=c.ngBlur||angular.noop,n.$on("$destroy",function(){y.$destroy()});var E=angular.element("<am-multiselect-popup"+(c.templateUrl?' template-url="'+c.templateUrl+'"':"")+"></am-multiselect-popup>");(c.required||c.ngRequired)&&(x=!0),c.$observe("required",function(e){x=e}),y.$watch(function(){return e(c.disabled)(n)},function(e){y.disabled=e}),y.$watch(function(){return e(c.multiple)(n)},function(e){b=e||!1}),y.$watch(function(){return k.source(n)},function(e){angular.isDefined(e)&&s()},!0),y.$watch(function(){return u.$modelValue},function(e,n){angular.isDefined(e)&&(h(e),y.$eval(w)),o(),u.$setValidity("required",y.valid())},!0),s(),i.append(t(E)(y)),y.valid=function(){if(!x)return!0;var e=u.$modelValue;return angular.isArray(e)&&e.length>0||!angular.isArray(e)&&null!=e},y.checkAll=function(){if(b){var e=y.searchText&&y.searchText.label.length>0?a("filter")(y.items,y.searchText):y.items;angular.forEach(e,function(e){e.checked=!0}),p(!0)}},y.uncheckAll=function(){var e=y.searchText&&y.searchText.label.length>0?a("filter")(y.items,y.searchText):y.items;angular.forEach(e,function(e){e.checked=!1}),p(!0)},y.select=function(e){!1===b?(f(e),y.toggleSelect()):g(e)}}}}]).directive("amMultiselectPopup",["$document","$filter",function(e,n){return{restrict:"E",scope:!1,replace:!0,templateUrl:function(e,n){return n.templateUrl||"multiselect.tmpl.html"},link:function(t,l,a){function r(n){i(n.target,l.find(n.target.tagName))?t.$parent.$eval(t.onBlur):(l.removeClass("open"),e.unbind("click",r),t.$apply())}t.selectedIndex=null,t.isVisible=!1,t.filteredItems=null,t.toggleSelect=function(){l.hasClass("open")?(l.removeClass("open"),e.unbind("click",r),t.$parent.$eval(t.onBlur)):(l.addClass("open"),e.bind("click",r),t.focus())},t.focus=function(){var e=l.find("input")[0];e&&e.focus()},t.keydown=function(e){var l=n("filter")(t.items,t.searchText),a=e.keyCode||e.which;13===a?l[t.selectedIndex]&&t.select(l[t.selectedIndex]):t.selectedIndex=38===a?null===t.selectedIndex?l.length-1:t.selectedIndex-1:40===a?null===t.selectedIndex?0:t.selectedIndex+1:null,t.selectedIndex<0?t.selectedIndex=l.length-1:t.selectedIndex>l.length-1&&(t.selectedIndex=0)};var i=function(e,n){for(var t=0;t<n.length;t++)if(e==n[t])return!0;return!1}}}}]),angular.module("am.multiselect").run(["$templateCache",function(e){e.put("multiselect.tmpl.html",'<div class="btn-group">\n    <button style=\'max-width:300px;\' type="button" class="btn btn-default dropdown-toggle" ng-click="toggleSelect()" ng-disabled="disabled" ng-class="{\'error\': !valid()}">\n        Languages\n        <span class="caret"></span>\n    </button>\n    <ul class="dropdown-menu sharado-dropdown-select">\n        <li>\n            <input class="form-control input-sm" type="text" ng-model="searchText.label" ng-keydown="keydown($event)" autofocus="autofocus" placeholder="Filter" />\n        </li>\n        <li ng-show="multiple" role="presentation" class="">\n                </li>\n        <li ng-repeat="i in items | filter:searchText" ng-class="{\'selected\': $index === selectedIndex}">\n            <a style=\'cursor:pointer\' ng-click="select(i); focus()">\n            <i class=\'glyphicon\' ng-class="{\'glyphicon-ok\': i.checked, \'empty\': !i.checked}"></i> {{i.label}}</a>\n        </li>\n    </ul>\n</div>\n')}]);